import base64

exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IGJhc2U2NApmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIGl0ZXJ0b29scyBpbXBvcnQgY3ljbGUKZnJvbSBjb2xvcmFtYSBpbXBvcnQgaW5pdCwgRm9yZSwgU3R5bGUKZnJvbSBmYWtlX3VzZXJhZ2VudCBpbXBvcnQgVXNlckFnZW50CmZyb20gcmVxdWVzdHNfaHRtbCBpbXBvcnQgSFRNTFNlc3Npb24KaW1wb3J0IGxvZ2dpbmcKZnJvbSByZXF1ZXN0cy5leGNlcHRpb25zIGltcG9ydCBSZXF1ZXN0RXhjZXB0aW9uCgppbXBvcnQgY29uZmlncGFyc2VyCgpjb25maWcgPSBjb25maWdwYXJzZXIuQ29uZmlnUGFyc2VyKCkKY29uZmlnLnJlYWQoJ2NvbmZpZy50eHQnLCBlbmNvZGluZz0ndXRmLTgnKQoKIyDEkOG7jWMgY8OhYyBnacOhIHRy4buLIHThu6sgY29uZmlnCmF1dG9fY2hlY2tfdGFza19saXN0ID0gY29uZmlnLmdldCgnREVGQVVMVCcsICdhdXRvX2NoZWNrX3Rhc2tfbGlzdCcpCmF1dG9fYXR0ZW5kYW5jZSA9IGNvbmZpZy5nZXQoJ0RFRkFVTFQnLCAnYXV0b19hdHRlbmRhbmNlJykKYXV0b19tb3JzZSA9IGNvbmZpZy5nZXQoJ0RFRkFVTFQnLCAnYXV0b19tb3JzZScpCmF1dG9fY2xhaW1fY29tYm8gPSBjb25maWcuZ2V0KCdERUZBVUxUJywgJ2F1dG9fY2xhaW1fY29tYm8nKQptYXhfY2FyZF9wcmljZSA9IGNvbmZpZy5nZXRpbnQoJ0RFRkFVTFQnLCAnbWF4X2NhcmRfcHJpY2UnKQphdXRvX21pbmlnYW1lID0gY29uZmlnLmdldCgnREVGQVVMVCcsICdhdXRvX21pbmlnYW1lJykKYXV0b191cGdyYWRlX211bHRpdGFwID0gY29uZmlnLmdldCgnREVGQVVMVCcsICdhdXRvX3VwZ3JhZGVfbXVsdGl0YXAnKQpsdl91cGdyYWRlX211bHRpdGFwID0gY29uZmlnLmdldGludCgnREVGQVVMVCcsICdsdl91cGdyYWRlX211bHRpdGFwJykKYXV0b191cGdyYWRlX2VuZXJneSA9IGNvbmZpZy5nZXQoJ0RFRkFVTFQnLCAnYXV0b191cGdyYWRlX2VuZXJneScpCmx2X3VwZ3JhZGVfZW5lcmd5ID0gY29uZmlnLmdldGludCgnREVGQVVMVCcsICdsdl91cGdyYWRlX2VuZXJneScpCmF1dG9fdXBncmFkZV9wcGggPSBjb25maWcuZ2V0KCdERUZBVUxUJywgJ2F1dG9fdXBncmFkZV9wcGgnKQptYXhfcHJpY2UgPSBjb25maWcuZ2V0aW50KCdERUZBVUxUJywgJ21heF9wcmljZScpCndhaXRfY29vbGRvd24gPSBjb25maWcuZ2V0KCdERUZBVUxUJywgJ3dhaXRfY29vbGRvd24nKQptYXhfd2FpdF9jb29sZG93biA9IGNvbmZpZy5nZXRpbnQoJ0RFRkFVTFQnLCAnbWF4X3dhaXRfY29vbGRvd24nKQpkZWxheV9iZXR3ZWVuX2FjY291bnRzID0gY29uZmlnLmdldCgnREVGQVVMVCcsICdkZWxheV9iZXR3ZWVuX2FjY291bnRzJykKbWF4X2RlbGF5X2JldHdlZW5fYWNjb3VudHMgPSBjb25maWcuZ2V0aW50KCdERUZBVUxUJywgJ21heF9kZWxheV9iZXR3ZWVuX2FjY291bnRzJykKCgpzZXNzaW9uID0gSFRNTFNlc3Npb24oKQp1YSA9IFVzZXJBZ2VudCgpCiMgSW5pdGlhbGl6ZSBjb2xvcmFtYQppbml0KGF1dG9yZXNldD1UcnVlKQoKbG9nZ2luZy5iYXNpY0NvbmZpZyhsZXZlbD1sb2dnaW5nLklORk8sIGZvcm1hdD0nJShhc2N0aW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnKQoKZGVmIGxvYWRfcHJveGllcygpOgogICAgd2l0aCBvcGVuKCdwcm94eS50eHQnLCAncicpIGFzIHByb3h5X2ZpbGU6CiAgICAgICAgcmV0dXJuIFtwcm94eS5zdHJpcCgpIGZvciBwcm94eSBpbiBwcm94eV9maWxlLnJlYWRsaW5lcygpXQoKZGVmIERhaWx5Q2lwaGVyRGVjb2RlKGNpcGhlcik6CiAgICBjaXBoZXIgPSBjaXBoZXJbOjNdICsgY2lwaGVyWzQ6XQogICAgY2lwaGVyID0gY2lwaGVyLmVuY29kZSgiYXNjaWkiKQogICAgY2lwaGVyID0gYmFzZTY0LmI2NGRlY29kZShjaXBoZXIpCiAgICBjaXBoZXIgPSBjaXBoZXIuZGVjb2RlKCJhc2NpaSIpCiAgICByZXR1cm4gY2lwaGVyCgpkZWYgcmVhZF9wcm9tb19rZXlzKCk6CiAgICB3aXRoIG9wZW4oJ3ZvdWNoZXIudHh0JywgJ3InKSBhcyBmaWxlOgogICAgICAgIHJldHVybiBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUgaWYgbGluZS5zdHJpcCgpXQogICAgCmRlZiBjYXRlZ29yaXplX3Byb21vX2NvZGVzKHByb21vX2tleXMpOgogICAgY2F0ZWdvcmllcyA9IHsKICAgICAgICAnQklLRSc6IFtdLCAnQ1VCRSc6IFtdLCAnVFJBSU4nOiBbXSwgJ0NMT05FJzogW10KICAgIH0KICAgIGZvciBrZXkgaW4gcHJvbW9fa2V5czoKICAgICAgICBmb3IgY2F0ZWdvcnkgaW4gY2F0ZWdvcmllczoKICAgICAgICAgICAgaWYga2V5LnN0YXJ0c3dpdGgoY2F0ZWdvcnkpOgogICAgICAgICAgICAgICAgY2F0ZWdvcmllc1tjYXRlZ29yeV0uYXBwZW5kKGtleSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICByZXR1cm4gY2F0ZWdvcmllcwoKZGVmIHJlbW92ZV9wcm9tb19rZXkodXNlZF9rZXkpOgogICAgd2l0aCBvcGVuKCd2b3VjaGVyLnR4dCcsICdyJykgYXMgZmlsZToKICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkKICAgIHdpdGggb3Blbigndm91Y2hlci50eHQnLCAndycpIGFzIGZpbGU6CiAgICAgICAgZmlsZS53cml0ZWxpbmVzKFtsaW5lIGZvciBsaW5lIGluIGxpbmVzIGlmIGxpbmUuc3RyaXAoKSAhPSB1c2VkX2tleV0pCgpkZWYgYXBwbHlfcHJvbW8oc2Vzc2lvbiwgdG9rZW4pOgogICAgcHJvbW9fa2V5cyA9IHJlYWRfcHJvbW9fa2V5cygpCiAgICBjYXRlZ29yaWVzID0gY2F0ZWdvcml6ZV9wcm9tb19jb2Rlcyhwcm9tb19rZXlzKQogICAgc3VjY2Vzc2Z1bF9rZXlzID0gW10KICAgIAogICAgZm9yIGNhdGVnb3J5IGluIFsnQklLRScsICdDVUJFJywgJ1RSQUlOJywgJ0NMT05FJ106CiAgICAgICAgYXR0ZW1wdHMgPSAwCiAgICAgICAgd2hpbGUgYXR0ZW1wdHMgPCA0IGFuZCBjYXRlZ29yaWVzW2NhdGVnb3J5XToKICAgICAgICAgICAgcHJvbW9fa2V5ID0gY2F0ZWdvcmllc1tjYXRlZ29yeV0ucG9wKDApCiAgICAgICAgICAgIHVybCA9ICJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2FwcGx5LXByb21vIgogICAgICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAgICAgIkF1dGhvcml6YXRpb24iOiBmIkJlYXJlciB7dG9rZW59IiwKICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXlsb2FkID0geyJwcm9tb0NvZGUiOiBwcm9tb19rZXl9CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXBheWxvYWQpCiAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJTdWNjZXNzZnVsbHkgYXBwbGllZCBwcm9tbyBjb2RlOiB7cHJvbW9fa2V5fSIpCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bF9rZXlzLmFwcGVuZChwcm9tb19rZXkpCiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdHMgKz0gMQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkZhaWxlZCB0byBhcHBseSBwcm9tbyBjb2RlOiB7cHJvbW9fa2V5fSIpCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllc1tjYXRlZ29yeV0uYXBwZW5kKHByb21vX2tleSkgICMgQWRkIGZhaWxlZCBrZXkgYmFjayB0byB0aGUgY2F0ZWdvcnkKICAgICAgICAgICAgICAgICAgICBicmVhayAgIyBNb3ZlIHRvIG5leHQgY2F0ZWdvcnkgb24gZmFpbHVyZQogICAgICAgICAgICBleGNlcHQgUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBhcHBseWluZyBwcm9tbyBjb2RlOiB7ZX0iKQogICAgICAgICAgICAgICAgY2F0ZWdvcmllc1tjYXRlZ29yeV0uYXBwZW5kKHByb21vX2tleSkgICMgQWRkIGZhaWxlZCBrZXkgYmFjayB0byB0aGUgY2F0ZWdvcnkKICAgICAgICAgICAgICAgIGJyZWFrICAjIE1vdmUgdG8gbmV4dCBjYXRlZ29yeSBvbiBlcnJvcgogICAgCiAgICAjIFJlbW92ZSBzdWNjZXNzZnVsIGtleXMgZnJvbSB2b3VjaGVyLnR4dAogICAgZm9yIGtleSBpbiBzdWNjZXNzZnVsX2tleXM6CiAgICAgICAgcmVtb3ZlX3Byb21vX2tleShrZXkpCiAgICAKICAgICMgVXBkYXRlIHZvdWNoZXIudHh0IHdpdGggcmVtYWluaW5nIGtleXMKICAgIHJlbWFpbmluZ19rZXlzID0gW2tleSBmb3IgY2F0IGluIGNhdGVnb3JpZXMudmFsdWVzKCkgZm9yIGtleSBpbiBjYXRdCiAgICB3aXRoIG9wZW4oJ3ZvdWNoZXIudHh0JywgJ3cnKSBhcyBmaWxlOgogICAgICAgIGZvciBrZXkgaW4gcmVtYWluaW5nX2tleXM6CiAgICAgICAgICAgIGZpbGUud3JpdGUoZiJ7a2V5fVxuIikKCgoKZGVmIFRleHRUb01vcnNlQ29kZSh0ZXh0KToKICAgIG1vcnNlX2NvZGUgPSB7CiAgICAgICAgIkEiOiAiLi0iLCAiQiI6ICItLi4uIiwgIkMiOiAiLS4tLiIsICJEIjogIi0uLiIsICJFIjogIi4iLCAiRiI6ICIuLi0uIiwgCiAgICAgICAgIkciOiAiLS0uIiwgIkgiOiAiLi4uLiIsICJJIjogIi4uIiwgIkoiOiAiLi0tLSIsICJLIjogIi0uLSIsICJMIjogIi4tLi4iLCAKICAgICAgICAiTSI6ICItLSIsICJOIjogIi0uIiwgIk8iOiAiLS0tIiwgIlAiOiAiLi0tLiIsICJRIjogIi0tLi0iLCAiUiI6ICIuLS4iLCAKICAgICAgICAiUyI6ICIuLi4iLCAiVCI6ICItIiwgIlUiOiAiLi4tIiwgIlYiOiAiLi4uLSIsICJXIjogIi4tLSIsICJYIjogIi0uLi0iLCAKICAgICAgICAiWSI6ICItLi0tIiwgIloiOiAiLS0uLiIsICIwIjogIi0tLS0tIiwgIjEiOiAiLi0tLS0iLCAiMiI6ICIuLi0tLSIsIAogICAgICAgICIzIjogIi4uLi0tIiwgIjQiOiAiLi4uLi0iLCAiNSI6ICIuLi4uLiIsICI2IjogIi0uLi4uIiwgIjciOiAiLS0uLi4iLCAKICAgICAgICAiOCI6ICItLS0uLiIsICI5IjogIi0tLS0uIiwgIiAiOiAiLyIsICIuIjogIi4tLi0uLSIsICIsIjogIi0tLi4tLSIsIAogICAgICAgICI/IjogIi4uLS0uLiIsICInIjogIi4tLS0tLiIsICIhIjogIi0uLS4tLSIsICIvIjogIi0uLi0uIiwgIigiOiAiLS4tLS4iLCAKICAgICAgICAiKSI6ICItLi0tLi0iLCAiJiI6ICIuLS4uLiIsICI6IjogIi0tLS4uLiIsICI7IjogIi0uLS4tLiIsICI9IjogIi0uLi4tIiwgCiAgICAgICAgIisiOiAiLi0uLS4iLCAiLSI6ICItLi4uLi0iLCAiXyI6ICIuLi0tLi0iLCAnIic6ICIuLS4uLS4iLCAiJCI6ICIuLi4tLi4tIiwgCiAgICAgICAgIkAiOiAiLi0tLi0uIiwKICAgIH0KICAgIHRleHQgPSB0ZXh0LnVwcGVyKCkKICAgIG1vcnNlID0gIiIKICAgIGZvciBjaGFyIGluIHRleHQ6CiAgICAgICAgaWYgY2hhciBpbiBtb3JzZV9jb2RlOgogICAgICAgICAgICBtb3JzZSArPSBtb3JzZV9jb2RlW2NoYXJdICsgIiAiCiAgICByZXR1cm4gbW9yc2UKCmRlZiBjb3VudGRvd24odCk6CiAgICB3aGlsZSB0OgogICAgICAgIG1pbnV0ZXMsIHNlY29uZHMgPSBkaXZtb2QodCwgNjApCiAgICAgICAgbWludXRlcyA9IHN0cihtaW51dGVzKS56ZmlsbCgyKQogICAgICAgIHNlY29uZHMgPSBzdHIoc2Vjb25kcykuemZpbGwoMikKICAgICAgICBwcmludChGb3JlLkNZQU4gKyBTdHlsZS5CUklHSFQgKyBmIlsgQ291bnRkb3duCV0gOiBXYWl0IGZvciB7bWludXRlc306e3NlY29uZHN9IHNlY29uZHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiwgZmx1c2g9VHJ1ZSwgZW5kPSJcciIpCiAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgIHQgLT0gMQogICAgcHJpbnQoIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCBmbHVzaD1UcnVlLCBlbmQ9IlxyIikgIAoKZGVmIHNlcGFyYXRvcihkYXRhKToKICAgIHNlcGFyYXRlZCA9ICd7Oix9Jy5mb3JtYXQoaW50KGRhdGEpKQogICAgcmV0dXJuIHNlcGFyYXRlZAkKCmRlZiBsb2FkX3Rva2VucyhmaWxlbmFtZSk6CiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHJldHVybiBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGVdCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2ZpbGVuYW1lfSIpCiAgICAgICAgcmV0dXJuIFtdCgpkZWYgZ2V0X2hlYWRlcnModG9rZW46IHN0ciwgcHJveHk6IHN0cikgLT4gZGljdDoKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ0FjY2VwdCc6ICcqLyonLAogICAgICAgICdBY2NlcHQtTGFuZ3VhZ2UnOiAnZW4tVVMsZW47cT0wLjknLAogICAgICAgICdBdXRob3JpemF0aW9uJzogZidCZWFyZXIge3Rva2VufScsCiAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScsCiAgICAgICAgJ09yaWdpbic6ICdodHRwczovL2hhbXN0ZXJrb21iYXRnYW1lLmlvJywKICAgICAgICAnUmVmZXJlcic6ICdodHRwczovL2hhbXN0ZXJrb21iYXRnYW1lLmlvLycsCiAgICAgICAgJ1NlYy1GZXRjaC1EZXN0JzogJ2VtcHR5JywKICAgICAgICAnU2VjLUZldGNoLU1vZGUnOiAnY29ycycsCiAgICAgICAgJ1NlYy1GZXRjaC1TaXRlJzogJ3NhbWUtc2l0ZScsCiAgICAgICAgJ1VzZXItQWdlbnQnOiB1YS5yYW5kb20sCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgfQogICAgcHJveGllcyA9IHsnaHR0cCc6IGYnaHR0cDovL3twcm94eX0nLCAnaHR0cHMnOiBmJ2h0dHA6Ly97cHJveHl9J30KICAgIHJldHVybiBoZWFkZXJzLCBwcm94aWVzCgpkZWYgZ2V0X3Rva2VuKGluaXRfZGF0YV9yYXcsIHByb3h5LCBtYXhfcmV0cmllcz0zKToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9hdXRoL2F1dGgtYnktdGVsZWdyYW0td2ViYXBwJwogICAgaGVhZGVycyA9IHsKICAgICAgICAnQWNjZXB0LUxhbmd1YWdlJzogJ2VuLVVTLGVuO3E9MC45JywKICAgICAgICAnQ29ubmVjdGlvbic6ICdrZWVwLWFsaXZlJywKICAgICAgICAnT3JpZ2luJzogJ2h0dHBzOi8vaGFtc3RlcmtvbWJhdGdhbWUuaW8nLAogICAgICAgICdSZWZlcmVyJzogJ2h0dHBzOi8vaGFtc3RlcmtvbWJhdGdhbWUuaW8vJywKICAgICAgICAnU2VjLUZldGNoLURlc3QnOiAnZW1wdHknLAogICAgICAgICdTZWMtRmV0Y2gtTW9kZSc6ICdjb3JzJywKICAgICAgICAnU2VjLUZldGNoLVNpdGUnOiAnc2FtZS1zaXRlJywKICAgICAgICAnVXNlci1BZ2VudCc6IHVhLnJhbmRvbSwKICAgICAgICAnYWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICAgIH0KICAgIHByb3hpZXMgPSB7J2h0dHAnOiBmJ2h0dHA6Ly97cHJveHl9JywgJ2h0dHBzJzogZidodHRwOi8ve3Byb3h5fSd9CiAgICBkYXRhID0ganNvbi5kdW1wcyh7ImluaXREYXRhUmF3IjogaW5pdF9kYXRhX3Jhd30pCiAgICAKICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9yZXRyaWVzKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlcyA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlcy5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlcy50ZXh0LnN0cmlwKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKVsnYXV0aFRva2VuJ10KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dpbmcud2FybmluZyhmIkVtcHR5IHJlc3BvbnNlIHJlY2VpdmVkIG9uIGF0dGVtcHQge2F0dGVtcHQgKyAxfSIpCiAgICAgICAgZXhjZXB0IChSZXF1ZXN0RXhjZXB0aW9uLCBqc29uLkpTT05EZWNvZGVFcnJvcikgYXMgZToKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIG9uIGF0dGVtcHQge2F0dGVtcHQgKyAxfToge3N0cihlKX0iKQogICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyICoqIGF0dGVtcHQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKCJNYXggcmV0cmllcyByZWFjaGVkLiBVbmFibGUgdG8gZ2V0IHRva2VuLiIpCiAgICAKICAgICAgICBleGNlcHQgUHJveHlFcnJvcjoKICAgICAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJQcm94eSBlcnJvciBlbmNvdW50ZXJlZC4gU2tpcHBpbmcgdG8gbmV4dCBwcm94eS1hY2NvdW50IHBhaXIuIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCgkJCmRlZiBhdXRoZW50aWNhdGUodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9hdXRoL21lLXRlbGVncmFtJwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiBzeW5jX2NsaWNrZXIodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3N5bmMnCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcykKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGNsYWltX2RhaWx5KHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9jaGVjay10YXNrJwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIGhlYWRlcnNbJ2FjY2VwdCddID0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICBoZWFkZXJzWydjb250ZW50LXR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgZGF0YSA9IGpzb24uZHVtcHMoeyJ0YXNrSWQiOiAic3RyZWFrX2RheXMifSkKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWRhdGEsIHByb3hpZXM9cHJveGllcykKICAgIHJldHVybiByZXNwb25zZQoKZGVmIHVwZ3JhZGUodG9rZW4sIHVwZ3JhZGVfdHlwZSwgcHJveHkpOgogICAgdXJsID0gJ2h0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvYnV5LWJvb3N0JwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIGhlYWRlcnNbJ2FjY2VwdCddID0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICBoZWFkZXJzWydjb250ZW50LXR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgZGF0YSA9IGpzb24uZHVtcHMoeyJib29zdElkIjogdXBncmFkZV90eXBlLCAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKX0pCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiB0YXAodG9rZW4sIG1heF90YXBzLCBhdmFpbGFibGVfdGFwcywgcHJveHkpOgogICAgdXJsID0gJ2h0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvdGFwJwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIGhlYWRlcnNbJ2FjY2VwdCddID0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICBoZWFkZXJzWydjb250ZW50LXR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgZGF0YSA9IGpzb24uZHVtcHMoeyJjb3VudCI6IG1heF90YXBzLCAiYXZhaWxhYmxlVGFwcyI6IGF2YWlsYWJsZV90YXBzLCAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKX0pCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiBsaXN0X3Rhc2tzKHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9saXN0LXRhc2tzJwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiBnZXRfY29tYm8oaXRlbSk6CiAgICB1cmwgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3VuYWRhdmluYS9oay9tYWluL2NvbWJvIgogICAgcmVxdWVzdCA9IHJlcXVlc3RzLmdldCh1cmwpCiAgICBDdXJyZW50Q29tYm8gPSByZXF1ZXN0LnRleHQKICAgIENvbWJvTGlzdCA9IEN1cnJlbnRDb21iby5zcGxpdCgpCiAgICBpZiBpdGVtID09ICJpdGVtIjoKICAgICAgICBDb21ib19MaXN0ID0gW0NvbWJvTGlzdFswXSwgQ29tYm9MaXN0WzFdLCBDb21ib0xpc3RbMl1dCiAgICBlbHNlOgogICAgICAgIENvbWJvX0xpc3QgPSBDb21ib0xpc3RbNF0KICAgIHJldHVybiBDb21ib19MaXN0CgpkZWYgc3RhcnRfbWluaWdhbWUodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3N0YXJ0LWtleXMtbWluaWdhbWUnCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcykKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGNsYWltX01pbmlHYW1lKHRva2VuLCBkZWxheSwgaWR1c2VyLCBwcm94eSk6CiAgICByYW5kb21fcHJlZml4ID0gJzAnICsgc3RyKGRlbGF5KSArIHN0cihyYW5kb20ucmFuZGludCgxMDAwMDAwMDAwMCwgOTk5OTk5OTk5OTkpKVs6MTBdCiAgICBjaXBoZXIgPSBmJ3tyYW5kb21fcHJlZml4fXx7aWR1c2VyfScKICAgIGJhc2U2NF9jaXBoZXIgPSBiYXNlNjQuYjY0ZW5jb2RlKGNpcGhlci5lbmNvZGUoKSkuZGVjb2RlKCkKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NsYWltLWRhaWx5LWtleXMtbWluaWdhbWUnCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgaGVhZGVyc1snYWNjZXB0J10gPSAnYXBwbGljYXRpb24vanNvbicKICAgIGhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICBkYXRhID0ganNvbi5kdW1wcyh7ImNpcGhlciI6IGJhc2U2NF9jaXBoZXJ9KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgcHJveGllcz1wcm94aWVzKQogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlCiAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArICJGYWlsZWQgdG8gcGFyc2UgSlNPTiBmcm9tIHJlc3BvbnNlLiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICBlbGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDQwMDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiRmFpbGVkIHRvIHBhcnNlIEpTT04gZnJvbSByZXNwb25zZS4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgZWxpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSA1MDA6CiAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIkZhaWxlZCB0byBjbGFpbSBNaW5pR2FtZSwgSW50ZXJuYWwgU2VydmVyIEVycm9yIiwgZmx1c2g9VHJ1ZSkKICAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIkZhaWxlZCB0byBjbGFpbSBNaW5pR2FtZSwgc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X2lwKHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vaXAnCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcykKICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiRmFpbGVkIHRvIHBhcnNlIEpTT04gZnJvbSByZXNwb25zZS4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgZWxpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSA0MDA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIkZhaWxlZCB0byBwYXJzZSBKU09OIGZyb20gcmVzcG9uc2UuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIGVsaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNTAwOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJGYWlsZWQgdG8gZ2V0IElQLCBJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiByZXNwb25zZQogICAgZWxzZToKICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiRmFpbGVkIHRvIGdldCBJUCwgc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgR2V0QWNjb3VudENvbmZpZ1JlcXVlc3QodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NvbmZpZycKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzKQogICAgcmV0dXJuIHJlc3BvbnNlCgpkZWYgZXhjaGFuZ2UodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3NlbGVjdC1leGNoYW5nZScKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICBoZWFkZXJzWydhY2NlcHQnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSAnYXBwbGljYXRpb24vanNvbicKICAgIGRhdGEgPSBqc29uLmR1bXBzKHsiZXhjaGFuZ2VJZCI6ICdiaW5hbmNlJ30pCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiBjbGFpbV9jaXBoZXIodG9rZW4sIERhaWx5TW9yc2UsIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NsYWltLWRhaWx5LWNpcGhlcicKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICBoZWFkZXJzWydhY2NlcHQnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSAnYXBwbGljYXRpb24vanNvbicKICAgIGRhdGEgPSBqc29uLmR1bXBzKHsiY2lwaGVyIjogRGFpbHlNb3JzZX0pCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICAKICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiRmFpbGVkIHRvIHBhcnNlIEpTT04gZnJvbSByZXNwb25zZS4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgZWxpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSA0MDA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIkZhaWxlZCB0byBwYXJzZSBKU09OIGZyb20gcmVzcG9uc2UuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIGVsaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNTAwOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJGYWlsZWQgdG8gY2xhaW0gY2lwaGVyLCBJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiByZXNwb25zZQogICAgZWxzZToKICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiRmFpbGVkIHRvIGNsYWltIGNpcGhlciwgc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgY2hlY2tfdGFzayh0b2tlbiwgdGFza19pZCwgcHJveHkpOgogICAgdXJsID0gJ2h0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvY2hlY2stdGFzaycKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICBoZWFkZXJzWydhY2NlcHQnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSAnYXBwbGljYXRpb24vanNvbicKICAgIGRhdGEgPSBqc29uLmR1bXBzKHsidGFza0lkIjogdGFza19pZH0pCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICByZXR1cm4gcmVzcG9uc2UKCmRlZiBjaGVja19ib29zdGVyKHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9ib29zdHMtZm9yLWJ1eScKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzKQogICAgcmV0dXJuIHJlc3BvbnNlCgpkZWYgdXNlX2Jvb3N0ZXIodG9rZW4sIGlkYm9vc3QsIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2J1eS1ib29zdCcKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICBoZWFkZXJzWydhY2NlcHQnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSAnYXBwbGljYXRpb24vanNvbicKICAgIGRhdGEgPSBqc29uLmR1bXBzKHsiYm9vc3RJZCI6IGlkYm9vc3QsICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpfSkKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWRhdGEsIHByb3hpZXM9cHJveGllcykKICAgIHJldHVybiByZXNwb25zZQoKZGVmIHJlYWRfdXBncmFkZV9saXN0KGZpbGVuYW1lKToKICAgIHdpdGggb3BlbihmaWxlbmFtZSwgJ3InKSBhcyBmaWxlOgogICAgICAgIHJldHVybiBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGVdCgpkZWYgZ2V0X2F2YWlsYWJsZV91cGdyYWRlcyh0b2tlbiwgcHJveHkpOgogICAgdXJsID0gJ2h0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvdXBncmFkZXMtZm9yLWJ1eScKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzKQogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHRyeToKICAgICAgICAgICAgdXBncmFkZXMgPSByZXNwb25zZS5qc29uKClbJ3VwZ3JhZGVzRm9yQnV5J10KICAgICAgICAgICAgcmV0dXJuIHVwZ3JhZGVzCiAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArICJcclsgVXBncmFkZQldIDogRmFpbGVkIHRvIGdldCBKU09OIHJlc3BvbnNlLiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgZWxzZToKICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFVwZ3JhZGUJXSA6IEZhaWxlZCB0byBnZXQgdXBncmFkZSBsaXN0OiBTdGF0dXMge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIsIGZsdXNoPVRydWUpCiAgICAgICAgcmV0dXJuIFtdCgpkZWYgYnV5X3VwZ3JhZGUodG9rZW4sIHVwZ3JhZGVfaWQsIHVwZ3JhZGVfbmFtZSwgcHJveHkpOgogICAgdXJsID0gJ2h0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvYnV5LXVwZ3JhZGUnCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgZGF0YSA9IGpzb24uZHVtcHMoeyJ1cGdyYWRlSWQiOiB1cGdyYWRlX2lkLCAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKX0pCiAgICB0aW1lLnNsZWVwKDMpCiAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgVXBncmFkZQldIDogU3VjY2Vzc2Z1bGx5IHVwZ3JhZGVkLi4uIiwgZmx1c2g9VHJ1ZSkKICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIlxyWyBVcGdyYWRlCV0gOiBGYWlsZWQgdG8gcGFyc2UgSlNPTiBkdXJpbmcgdXBncmFkZS4iLCBmbHVzaD1UcnVlKQogICAgZWxzZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVycm9yX3Jlc3BvbnNlID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGlmIGVycm9yX3Jlc3BvbnNlLmdldCgnZXJyb3JfY29kZScpID09ICdJTlNVRkZJQ0lFTlRfRlVORFMnOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBOb3QgZW5vdWdoIGNvaW5zIDpWICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgcmV0dXJuICdpbnN1ZmZpY2llbnRfZnVuZHMnCiAgICAgICAgICAgIGVsaWYgZXJyb3JfcmVzcG9uc2UuZ2V0KCdlcnJvcl9jb2RlJykgPT0gJ1VQR1JBREVfQ09PTERPV04nOgogICAgICAgICAgICAgICAgY29vbGRvd25fc2Vjb25kcyA9IGVycm9yX3Jlc3BvbnNlLmdldCgnY29vbGRvd25TZWNvbmRzJywgMCkKICAgICAgICAgICAgICAgIG1pbnV0ZXMsIHNlY29uZHMgPSBkaXZtb2QoY29vbGRvd25fc2Vjb25kcywgNjApCiAgICAgICAgICAgICAgICBob3VycywgbWludXRlcyA9IGRpdm1vZChtaW51dGVzLCA2MCkKICAgICAgICAgICAgICAgIGhvdXJzID0gc3RyKGhvdXJzKS56ZmlsbCgyKQogICAgICAgICAgICAgICAgbWludXRlcyA9IHN0cihtaW51dGVzKS56ZmlsbCgyKQogICAgICAgICAgICAgICAgc2Vjb25kcyA9IHN0cihzZWNvbmRzKS56ZmlsbCgyKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgVXBncmFkZQldIDoge3VwZ3JhZGVfbmFtZX0gQ09PTERPV046IHtob3Vyc30gSG91cnMge21pbnV0ZXN9IE1pbnV0ZXMge3NlY29uZHN9IFNlY29uZHMuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgIHJldHVybiB7J2Nvb2xkb3duJzogVHJ1ZSwgJ2Nvb2xkb3duX3NlY29uZHMnOiBjb29sZG93bl9zZWNvbmRzfQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBGYWlsZWQgdXBncmFkZSB7dXBncmFkZV9uYW1lfToge2Vycm9yX3Jlc3BvbnNlfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICByZXR1cm4geydlcnJvcic6IFRydWUsICdtZXNzYWdlJzogZXJyb3JfcmVzcG9uc2V9CiAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFVwZ3JhZGUJXSA6IEZhaWxlZCB0byBnZXQgSlNPTiByZXNwb25zZS4gU3RhdHVzOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIHsnZXJyb3InOiBUcnVlLCAnc3RhdHVzX2NvZGUnOiByZXNwb25zZS5zdGF0dXNfY29kZX0KCmRlZiBnZXRfYXZhaWxhYmxlX3VwZ3JhZGVzX2NvbWJvKHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci91cGdyYWRlcy1mb3ItYnV5JwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMpCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cGdyYWRlcyA9IHJlc3BvbnNlLmpzb24oKVsndXBncmFkZXNGb3JCdXknXQogICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IFN1Y2Nlc3NmdWxseSBnb3QgdXBncmFkZSBsaXN0LiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgIHJldHVybiB1cGdyYWRlcwogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiXHJbIERhaWx5IENvbWJvCV0gOiBGYWlsZWQgdG8gZ2V0IEpTT04gcmVzcG9uc2UuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICBlbHNlOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZCB0byBnZXQgdXBncmFkZSBsaXN0OiBTdGF0dXMge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIsIGZsdXNoPVRydWUpCiAgICAgICAgcmV0dXJuIFtdCgpkZWYgYnV5X3VwZ3JhZGVfY29tYm8odG9rZW4sIHVwZ3JhZGVfaWQsIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2J1eS11cGdyYWRlJwogICAgaGVhZGVycywgcHJveGllcyA9IGdldF9oZWFkZXJzKHRva2VuLCBwcm94eSkKICAgIGRhdGEgPSBqc29uLmR1bXBzKHsidXBncmFkZUlkIjogdXBncmFkZV9pZCwgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSl9KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgcHJveGllcz1wcm94aWVzKQogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIERhaWx5IENvbWJvCV0gOiBDb21ibyB7dXBncmFkZV9pZH0gc3VjY2Vzc2Z1bGx5IHB1cmNoYXNlZC4iLCBmbHVzaD1UcnVlKQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiXHJbIERhaWx5IENvbWJvCV0gOiBGYWlsZWQgdG8gcGFyc2UgSlNPTiBkdXJpbmcgdXBncmFkZS4iLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiByZXNwb25zZQogICAgZWxzZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVycm9yX3Jlc3BvbnNlID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGlmIGVycm9yX3Jlc3BvbnNlLmdldCgnZXJyb3JfY29kZScpID09ICdJTlNVRkZJQ0lFTlRfRlVORFMnOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBEYWlseSBDb21ibwldIDogTm90IGVub3VnaCBjb2lucy4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgcmV0dXJuICdpbnN1ZmZpY2llbnRfZnVuZHMnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3JfcmVzcG9uc2UKICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZCB0byBnZXQgSlNPTiByZXNwb25zZS4gU3RhdHVzOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBhdXRvX3VwZ3JhZGVfcHBoX2Vhcm4odG9rZW4sIG1heF9wcmljZSwgcHJveHkpOgogICAgaW5zdWZmaWNpZW50X2Z1bmRzID0gRmFsc2UKICAgIGNvb2xkb3duX3VwZ3JhZGVzID0ge30KCiAgICB3aGlsZSBub3QgaW5zdWZmaWNpZW50X2Z1bmRzOgogICAgICAgIGF2YWlsYWJsZV91cGdyYWRlcyA9IGdldF9hdmFpbGFibGVfdXBncmFkZXModG9rZW4sIHByb3h5KQogICAgICAgIGJlc3RfdXBncmFkZSA9IE5vbmUKICAgICAgICBiZXN0X3ZhbHVlID0gMAoKICAgICAgICBjdXJyZW50X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGZvciB1cGdyYWRlIGluIGF2YWlsYWJsZV91cGdyYWRlczoKICAgICAgICAgICAgaWYgdXBncmFkZVsnaXNBdmFpbGFibGUnXSBhbmQgbm90IHVwZ3JhZGVbJ2lzRXhwaXJlZCddOgogICAgICAgICAgICAgICAgaWYgdXBncmFkZVsnaWQnXSBpbiBjb29sZG93bl91cGdyYWRlcyBhbmQgY3VycmVudF90aW1lIDwgY29vbGRvd25fdXBncmFkZXNbdXBncmFkZVsnaWQnXV06CiAgICAgICAgICAgICAgICAgICAgaWYgd2FpdF9jb29sZG93biA9PSAneSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvb2xkb3duX3NlY29uZHMgPD0gbWF4X3dhaXRfY29vbGRvd246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGRvd24oY29vbGRvd25fc2Vjb25kcykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBwcmljZSA9IHVwZ3JhZGVbJ3ByaWNlJ10KICAgICAgICAgICAgICAgIGlmIHByaWNlID4gbWF4X3ByaWNlOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgcHJvZml0X3Blcl9ob3VyID0gdXBncmFkZVsncHJvZml0UGVySG91ciddCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwcm9maXRfcGVyX2hvdXIgLyBwcmljZQogICAgICAgICAgICAgICAgZXhjZXB0IFplcm9EaXZpc2lvbkVycm9yOgogICAgICAgICAgICAgICAgICAgdmFsdWUgPSAwCgogICAgICAgICAgICAgICAgaWYgdmFsdWUgPiBiZXN0X3ZhbHVlOgogICAgICAgICAgICAgICAgICAgIGJlc3RfdmFsdWUgPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGJlc3RfdXBncmFkZSA9IHVwZ3JhZGUKCiAgICAgICAgaWYgYmVzdF91cGdyYWRlOgogICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBDYXJkOiB7YmVzdF91cGdyYWRlWyduYW1lJ119IHwgUFBIKzoge3NlcGFyYXRvcihiZXN0X3VwZ3JhZGVbJ3Byb2ZpdFBlckhvdXInXSl9IHwgUHJpY2U6IHtzZXBhcmF0b3IoYmVzdF91cGdyYWRlWydwcmljZSddKX0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICByZXN1bHQgPSBidXlfdXBncmFkZSh0b2tlbiwgYmVzdF91cGdyYWRlWydpZCddLCBiZXN0X3VwZ3JhZGVbJ25hbWUnXSwgcHJveHkpCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAnaW5zdWZmaWNpZW50X2Z1bmRzJzoKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIlsgVXBncmFkZQldIDogTm90IGVub3VnaCBjb2lucy4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgaW5zdWZmaWNpZW50X2Z1bmRzID0gVHJ1ZQogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UocmVzdWx0LCBkaWN0KSBhbmQgJ2Nvb2xkb3duJyBpbiByZXN1bHQ6CiAgICAgICAgICAgICAgICBjb29sZG93bl9zZWNvbmRzID0gcmVzdWx0Wydjb29sZG93bl9zZWNvbmRzJ10KICAgICAgICAgICAgICAgIGNvb2xkb3duX2VuZF90aW1lID0gY3VycmVudF90aW1lICsgY29vbGRvd25fc2Vjb25kcwogICAgICAgICAgICAgICAgY29vbGRvd25fdXBncmFkZXNbYmVzdF91cGdyYWRlWydpZCddXSA9IGNvb2xkb3duX2VuZF90aW1lCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShyZXN1bHQsIGRpY3QpIGFuZCAnZXJyb3InIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJbIFVwZ3JhZGUJXSA6IEZhaWxlZCB0byB1cGdyYWRlIHdpdGggZXJyb3I6IHtyZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ05vIGVycm9yIG1lc3NhZ2UgcHJvdmlkZWQnKX0iLCBmbHVzaD1UcnVlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgVXBncmFkZQldIDogTm8gdXBncmFkZXMgbWVldCB0aGUgY3JpdGVyaWEgYXQgdGhpcyB0aW1lLiAgICAgICAiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICBicmVhawoKCmRlZiBjaGVja19hbmRfdXBncmFkZSh0b2tlbiwgdXBncmFkZV9pZCwgcmVxdWlyZWRfbGV2ZWwsIHByb3h5KToKICAgIHVwZ3JhZGVzID0gZ2V0X2F2YWlsYWJsZV91cGdyYWRlc19jb21ibyh0b2tlbiwgcHJveHkpCiAgICBpZiB1cGdyYWRlczoKICAgICAgICBmb3IgdXBncmFkZSBpbiB1cGdyYWRlczoKICAgICAgICAgICAgaWYgdXBncmFkZVsnaWQnXSA9PSB1cGdyYWRlX2lkIGFuZCB1cGdyYWRlWydsZXZlbCddIDwgcmVxdWlyZWRfbGV2ZWwgKyAxOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgZiJbIERhaWx5IENvbWJvCV0gOiBVcGdyYWRpbmcge3VwZ3JhZGVfaWR9IiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgcmVxX2xldmVsX3RvdGFsID0gcmVxdWlyZWRfbGV2ZWwgKyAxCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShyZXFfbGV2ZWxfdG90YWwgLSB1cGdyYWRlWydsZXZlbCddKToKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBidXlfdXBncmFkZV9jb21ibyh0b2tlbiwgdXBncmFkZV9pZCwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIGRpY3QpIGFuZCAnZXJyb3JfY29kZScgaW4gcmVzdWx0IGFuZCByZXN1bHRbJ2Vycm9yX2NvZGUnXSA9PSAnVVBHUkFERV9OT1RfQVZBSUxBQkxFJzoKICAgICAgICAgICAgICAgICAgICAgICAgbmVlZGVkX3VwZ3JhZGUgPSByZXN1bHRbJ2Vycm9yX21lc3NhZ2UnXS5zcGxpdCgnOicpWy0xXS5zdHJpcCgpLnNwbGl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgbmVlZGVkX3VwZ3JhZGVfaWQgPSBuZWVkZWRfdXBncmFkZVsxXQogICAgICAgICAgICAgICAgICAgICAgICBuZWVkZWRfdXBncmFkZV9sZXZlbCA9IGludChuZWVkZWRfdXBncmFkZVstMV0pCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IFRyeWluZyB0byBidXkge25lZWRlZF91cGdyYWRlX2lkfSBsZXZlbCB7bmVlZGVkX3VwZ3JhZGVfbGV2ZWx9IiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGVja19hbmRfdXBncmFkZSh0b2tlbiwgbmVlZGVkX3VwZ3JhZGVfaWQsIG5lZWRlZF91cGdyYWRlX2xldmVsLCBwcm94eSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IFN1Y2Nlc3NmdWxseSB1cGdyYWRlZCB7bmVlZGVkX3VwZ3JhZGVfaWR9IHRvIGxldmVsIHtuZWVkZWRfdXBncmFkZV9sZXZlbH0uIFRyeWluZyB0byB1cGdyYWRlIHt1cGdyYWRlX2lkfSBhZ2Fpbi4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZCB0byB1cGdyYWRlIHtuZWVkZWRfdXBncmFkZV9pZH0gdG8gbGV2ZWwge25lZWRlZF91cGdyYWRlX2xldmVsfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBlbGlmIHJlc3VsdCA9PSAnaW5zdWZmaWNpZW50X2Z1bmRzJzoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBEYWlseSBDb21ibwldIDogTm90IGVub3VnaCBjb2lucyB0byB1cGdyYWRlIHt1cGdyYWRlX2lkfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIGVsaWYgcmVzdWx0LnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBEYWlseSBDb21ibwldIDogRmFpbGVkIHRvIHVwZ3JhZGUge3VwZ3JhZGVfaWR9IHdpdGggZXJyb3I6IHtyZXN1bHR9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IFVwZ3JhZGUge3VwZ3JhZGVfaWR9IHN1Y2Nlc3NmdWxseSBkb25lIHRvIGxldmVsIHtyZXF1aXJlZF9sZXZlbH0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQoKZGVmIGNsYWltX2RhaWx5X2NvbWJvKHRva2VuLCBwcm94eSk6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9jbGFpbS1kYWlseS1jb21ibycKICAgIGhlYWRlcnMsIHByb3hpZXMgPSBnZXRfaGVhZGVycyh0b2tlbiwgcHJveHkpCiAgICBoZWFkZXJzWydDb250ZW50LUxlbmd0aCddID0gJzAnCiAgICAKICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMpCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArICJcclsgRGFpbHkgQ29tYm8JXSA6IFN1Y2Nlc3NmdWxseSBjbGFpbWVkIGRhaWx5IGNvbWJvLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZWxzZToKICAgICAgICBlcnJvcl9yZXNwb25zZSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGlmIGVycm9yX3Jlc3BvbnNlLmdldCgnZXJyb3JfY29kZScpID09ICdEQUlMWV9DT01CT19ET1VCTEVfQ0xBSU1FRCc6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIlxyWyBEYWlseSBDb21ibwldIDogQ29tYm8gaGFzIGFscmVhZHkgYmVlbiBjbGFpbWVkICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIERhaWx5IENvbWJvCV0gOiBCdXkgQ29tYm8gZmlyc3QuLi4iLCBmbHVzaD1UcnVlKQogICAgICAgIHJldHVybiBlcnJvcl9yZXNwb25zZQogICAgCmRlZiBjaGVja19jb21ib19wdXJjaGFzZWQodG9rZW4sIHByb3h5KToKICAgIHVybCA9ICdodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3VwZ3JhZGVzLWZvci1idXknCiAgICBoZWFkZXJzLCBwcm94aWVzID0gZ2V0X2hlYWRlcnModG9rZW4sIHByb3h5KQogICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcykKICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgcHVyY2hhc2VkX2NvbWJvcyA9IGRhdGEuZ2V0KCdkYWlseUNvbWJvJywge30pLmdldCgndXBncmFkZUlkcycsIFtdKQogICAgICAgIHJldHVybiBwdXJjaGFzZWRfY29tYm9zCiAgICBlbHNlOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJGYWlsZWQgdG8gZ2V0IGNvbWJvIHN0YXR1cy4gU3RhdHVzOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICByZXR1cm4gTm9uZQoKIyBNQUlOIENPREUKY2hlY2tfdGFza19kaWN0ID0ge30KY2xhaW1lZF9jaXBoZXJzID0gc2V0KCkKY2xhaW1lZF9taW5pZ2FtZSA9IHNldCgpCmNvbWJvX3VwZ3JhZGVkID0ge30KCmRlZiBtYWluKCk6CiAgICBnbG9iYWwgY2hlY2tfdGFza19kaWN0LCBjbGFpbWVkX2NpcGhlcnMsIGNsYWltZWRfbWluaWdhbWUsIGF1dG9fY2xhaW1fY29tYm8sIGNvbWJvX3VwZ3JhZGVkCiAgICAKICAgIHByaW50X3dlbGNvbWVfbWVzc2FnZSgpCiAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgIkJvdCBpcyBydW5uaW5nLi4uLiIpCiAgICBpbml0X2RhdGEgPSBsb2FkX3Rva2VucygnaW5pdGRhdGEudHh0JykKICAgIHByb3hpZXMgPSBsb2FkX3Byb3hpZXMoKQogICAgdG9rZW5fY3ljbGUgPSBjeWNsZSh6aXAoaW5pdF9kYXRhLCBwcm94aWVzKSkKCiAgICB0b2tlbl9kaWN0ID0ge30KICAgIHdoaWxlIFRydWU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbml0X2RhdGFfcmF3LCBwcm94eSA9IG5leHQodG9rZW5fY3ljbGUpCiAgICAgICAgICAgIHRva2VuID0gdG9rZW5fZGljdC5nZXQoaW5pdF9kYXRhX3JhdykKICAgICAgICAgICAgbWluaWdhbWVfZGVsYXkgPSByYW5kb20ucmFuZGludCg3LCAxNSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHRva2VuOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxuXG5cblxyQWNjb3VudDogUHJldmlvdXNseSBib3R0ZWQiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgaWYgZGVsYXlfYmV0d2Vlbl9hY2NvdW50cyA9PSAieSI6CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgPSByYW5kb20ucmFuZGludCgxLCBtYXhfZGVsYXlfYmV0d2Vlbl9hY2NvdW50cykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgPSAwICAgCiAgICAgICAgICAgICAgICBjb3VudGRvd24oZGVsYXkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0b2tlbiA9IGdldF90b2tlbihpbml0X2RhdGFfcmF3LCBwcm94eSkKICAgICAgICAgICAgICAgIGlmIHRva2VuIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyU2tpcHBpbmcgdG8gbmV4dCBhY2NvdW50IGR1ZSB0byBwcm94eSBlcnJvclxuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgaWYgdG9rZW46CiAgICAgICAgICAgICAgICAgICAgdG9rZW5fZGljdFtpbml0X2RhdGFfcmF3XSA9IHRva2VuCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXG5cblxyQWNjb3VudDogQWN0aXZlIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyU3dpdGNoaW5nIHRvIG5leHQgYWNjb3VudFxuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgYXBwbHlfcHJvbW8oc2Vzc2lvbiwgdG9rZW4pCgogICAgICAgICAgICBpZiBpbml0X2RhdGFfcmF3IG5vdCBpbiBjb21ib191cGdyYWRlZDoKICAgICAgICAgICAgICAgIGNvbWJvX3VwZ3JhZGVkW2luaXRfZGF0YV9yYXddID0gRmFsc2UKCiAgICAgICAgICAgIHJlc3BvbnNlID0gYXV0aGVudGljYXRlKHRva2VuLCBwcm94eSkKICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHVzZXJfZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VyX2RhdGEuZ2V0KCd0ZWxlZ3JhbVVzZXInLCB7fSkuZ2V0KCd1c2VybmFtZScsICdFbXB0eSBVc2VybmFtZScpCiAgICAgICAgICAgICAgICBmaXJzdG5hbWUgPSB1c2VyX2RhdGEuZ2V0KCd0ZWxlZ3JhbVVzZXInLCB7fSkuZ2V0KCdmaXJzdE5hbWUnLCAnRW1wdHknKQogICAgICAgICAgICAgICAgbGFzdG5hbWUgPSB1c2VyX2RhdGEuZ2V0KCd0ZWxlZ3JhbVVzZXInLCB7fSkuZ2V0KCdsYXN0TmFtZScsICdFbXB0eScpCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJ+fn5+fn5be0ZvcmUuV0hJVEUgKyBTdHlsZS5CUklHSFR9IHt1c2VybmFtZX0gfCB7Zmlyc3RuYW1lfSB7bGFzdG5hbWV9IHtGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUfV1+fn5+fn4iKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgSVAgSW5mbwldIDogR2V0dGluZyBJUCBpbmZvcm1hdGlvbi4uLiIsIGVuZD0iIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZ2V0X2lwKHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICBpcF9kYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgSVAgSW5mbwldIDogSVA6IHtpcF9kYXRhWydpcCddfSB8IElTUDoge2lwX2RhdGFbJ2Fzbl9vcmcnXX0gfCBDb3VudHJ5OiB7aXBfZGF0YVsnY291bnRyeV9jb2RlJ119IiwgIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIEFjY291bnQgaWQJXSA6IEdldHRpbmcgVVNFUiBpbmZvcm1hdGlvbi4uLiIsIGVuZD0iIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc3luY19jbGlja2VyKHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICBjbGlja2VyX2RhdGEgPSByZXNwb25zZS5qc29uKClbJ2NsaWNrZXJVc2VyJ10KICAgICAgICAgICAgICAgICAgICBpZHVzZXI9Y2xpY2tlcl9kYXRhWydpZCddCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgQWNjb3VudCBpZAldIDoge2lkdXNlcn0gICAgICAgICAgICAgICAgICAgICAgIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIFN0eWxlLkJSSUdIVCArIGYiXHJbIExldmVsCQldIDoge2NsaWNrZXJfZGF0YVsnbGV2ZWwnXX0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgU3R5bGUuQlJJR0hUICsgZiJbIFRvdGFsIEVhcm5lZAldIDoge3NlcGFyYXRvcihjbGlja2VyX2RhdGFbJ3RvdGFsQ29pbnMnXSl9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIFN0eWxlLkJSSUdIVCArIGYiWyBDb2luCQldIDoge3NlcGFyYXRvcihjbGlja2VyX2RhdGFbJ2JhbGFuY2VDb2lucyddKX0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgU3R5bGUuQlJJR0hUICsgZiJbIEVuZXJneQldIDoge3NlcGFyYXRvcihjbGlja2VyX2RhdGFbJ2F2YWlsYWJsZVRhcHMnXSl9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBib29zdHMgPSBjbGlja2VyX2RhdGFbJ2Jvb3N0cyddCiAgICAgICAgICAgICAgICAgICAgYm9vc3RfbWF4X3RhcHNfbGV2ZWwgPSBib29zdHMuZ2V0KCdCb29zdE1heFRhcHMnLCB7fSkuZ2V0KCdsZXZlbCcsIDApCiAgICAgICAgICAgICAgICAgICAgYm9vc3RfZWFybl9wZXJfdGFwX2xldmVsID0gYm9vc3RzLmdldCgnQm9vc3RFYXJuUGVyVGFwJywge30pLmdldCgnbGV2ZWwnLCAwKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArIFN0eWxlLkJSSUdIVCArIGYiWyBFbmVyZ3kgTGV2ZWwJXSA6IHtib29zdF9tYXhfdGFwc19sZXZlbH0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArIFN0eWxlLkJSSUdIVCArIGYiWyBUYXAgTGV2ZWwJXSA6IHtib29zdF9lYXJuX3Blcl90YXBfbGV2ZWx9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyBTdHlsZS5CUklHSFQgKyBmIlsgRXhjaGFuZ2UJXSA6IHtjbGlja2VyX2RhdGFbJ2V4Y2hhbmdlSWQnXX0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgIGlmIGNsaWNrZXJfZGF0YVsnZXhjaGFuZ2VJZCddID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyAnXHJTZXR0aW5nIGV4Y2hhbmdlIHRvIEJpbmFuY2UuLicsZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9zZXQgPSBleGNoYW5nZSh0b2tlbiwgcHJveHkpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBleGNoYW5nZV9zZXQuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArJ1xyU3VjY2Vzc2Z1bGx5IHNldCBleGNoYW5nZSB0byBCaW5hbmNlJywgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsnXHJGYWlsZWQgdG8gc2V0IGV4Y2hhbmdlJywgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyBTdHlsZS5CUklHSFQgKyBmIlsgSW5jb21lL0hvdXJdIDoge3NlcGFyYXRvcihjbGlja2VyX2RhdGFbJ2Vhcm5QYXNzaXZlUGVySG91ciddKX1cbiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXHJbIFRhcCBTdGF0dXMJXSA6IFRhcHBpbmcgLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQoKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHRhcCh0b2tlbiwgY2xpY2tlcl9kYXRhWydtYXhUYXBzJ10sIGNsaWNrZXJfZGF0YVsnYXZhaWxhYmxlVGFwcyddLCBwcm94eSkKICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyAiXHJbIFRhcCBTdGF0dXMJXSA6IFN1Y2Nlc3NmdWwgVGFwIFRhcC4uLiAgICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIEJvb3N0ZXIJXSA6IENoZWNraW5nIGJvb3N0ZXIuLi4iLCBlbmQ9IiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY2hlY2tfYm9vc3Rlcih0b2tlbiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJfaW5mbyA9IHJlc3BvbnNlLmpzb24oKVsnYm9vc3RzRm9yQnV5J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBib29zdCBpbiBib29zdGVyX2luZm86CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYm9vc3RbJ2lkJ10gPT0gJ0Jvb3N0RnVsbEF2YWlsYWJsZVRhcHMnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9jayA9IGJvb3N0WydtYXhMZXZlbCddIC0gYm9vc3RbJ2xldmVsJ10gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2xkb3duID0gYm9vc3RbJ2Nvb2xkb3duU2Vjb25kcyddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMsIHNlY29uZHMgPSBkaXZtb2QoY29vbGRvd24sIDYwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VycywgbWludXRlcyA9IGRpdm1vZChtaW51dGVzLCA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPSBzdHIoaG91cnMpLnpmaWxsKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBzdHIobWludXRlcykuemZpbGwoMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcyA9IHN0cihzZWNvbmRzKS56ZmlsbCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBob3VycyA9PSAnMDAnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnNfc3RyID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzX3N0ciA9IGYie2hvdXJzfSBIb3VycyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1pbnV0ZXMgPT0gJzAwJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXNfc3RyID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXNfc3RyID0gZiJ7bWludXRlc30gTWludXRlcyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0b2NrID09IC0xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvY2sgPSJPdXQgb2Ygc3RvY2siCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBCb29zdGVyCV0gOiBTdG9jayB7c3RvY2t9IHwgQ29vbGRvd24ge2hvdXJzX3N0cn17bWludXRlc19zdHJ9e3NlY29uZHN9IFNlY29uZHMgICAgIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvb2xkb3duID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIEJvb3N0ZWQJXSA6IEFjdGl2YXRpbmcgQm9vc3Rlci4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXNlX2Jvb3N0ZXIodG9rZW4sICJCb29zdEZ1bGxBdmFpbGFibGVUYXBzIiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgQm9vc3RlZAldIDogQm9vc3RlciBBY3RpdmF0ZWQiLCBmbHVzaD1UcnVlKSAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9pbmZvID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVycm9yX2luZm8uZ2V0KCdlcnJvcl9jb2RlJykgPT0gJ0JPT1NUX0NPT0xET1dOJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2xkb3duX3NlY29uZHMgPSBpbnQoZXJyb3JfaW5mby5nZXQoJ2Vycm9yX21lc3NhZ2UnKS5zcGxpdCgpWy0yXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2xkb3duX21pbnV0ZXMgPSBjb29sZG93bl9zZWNvbmRzIC8vIDYwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIEJvb3N0ZWQJXSA6IEJvb3N0ZXIgaW4gY29vbGRvd24ge2Nvb2xkb3duX21pbnV0ZXN9IG1pbnV0ZXMiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBCb29zdGVkCV0gOiBGYWlsZWQgdG8gYWN0aXZhdGUgYm9vc3RlciIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBCb29zdGVkCV0gOiBGYWlsZWQgdG8gYWN0aXZhdGUgYm9vc3RlciIsIGZsdXNoPVRydWUpCgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiXHJbIEJvb3N0ZXIJXSA6IFRhcCBTdGF0dXMgOiBGYWlsZWQgdG8gVGFwICAgICAgICAgICAiLCBmbHVzaD1UcnVlKQoKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArICJcclsgVGFwIFN0YXR1cwldIDogRmFpbGVkIHRvIFRhcCAgICAgICAgICAgIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgIyBEYWlseSBBdHRlbmRhbmNlCiAgICAgICAgICAgICAgICAgICAgaWYgYXV0b19hdHRlbmRhbmNlID09ICd5JzoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXHJbIERhaWx5IEF0dGVuZGFuY2UJXSA6IENoZWNraW5nLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKSAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY2xhaW1fZGFpbHkodG9rZW4sIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYWlseV9yZXNwb25zZSA9IHJlc3BvbnNlLmpzb24oKVsndGFzayddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkYWlseV9yZXNwb25zZVsnaXNDb21wbGV0ZWQnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQXR0ZW5kYW5jZQldIDogIERheSB7ZGFpbHlfcmVzcG9uc2VbJ2RheXMnXX0gfCBDb21wbGV0ZWQuLiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIFN0eWxlLkJSSUdIVCArIGYiXHJbIERhaWx5IEF0dGVuZGFuY2UJXSA6ICBEYXkge2RhaWx5X3Jlc3BvbnNlWydkYXlzJ119IHwgQWxyZWFkeSBhdHRlbmRlZCBwcmV2aW91c2x5IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQXR0ZW5kYW5jZQldIDogIEZhaWxlZCB0byBBdHRlbmQuLiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkJMVUUgKyBmIlxyWyBEYWlseSBBdHRlbmRhbmNlCV0gOiAtLT4gT0ZGIiwgZmx1c2g9VHJ1ZSkgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBHZXQgTW9yc2UgZGF0YSBhbmQgZGVjb2RlIHRvIERhaWx5IENpcGhlcgogICAgICAgICAgICAgICAgICAgIERhaWx5TW9yc2UgPSAiIiAgIAogICAgICAgICAgICAgICAgICAgIGlmIGF1dG9fbW9yc2UgPT0gJ3knOgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IEdldEFjY291bnRDb25maWdSZXF1ZXN0KHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9yc2VEYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIERhaWx5TW9yc2UgPSBEYWlseUNpcGhlckRlY29kZShNb3JzZURhdGFbImRhaWx5Q2lwaGVyIl1bImNpcGhlciJdKQogICAgICAgICAgICAgICAgICAgICAgICBNb3JzZUNvZGUgPSBUZXh0VG9Nb3JzZUNvZGUoRGFpbHlNb3JzZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgTW9yc2UJXSA6IFdvcmQ6IHtEYWlseU1vcnNlfSB8IE1vcnNlOiB7TW9yc2VDb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2VuIG5vdCBpbiBjbGFpbWVkX2NpcGhlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgQ2xhaW0gTW9yc2UJXSA6IENsYWltaW5nIE1vcnNlLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjbGFpbV9jaXBoZXIodG9rZW4sIERhaWx5TW9yc2UsIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9udXNjb2lucyA9IHJlc3BvbnNlLmpzb24oKVsnZGFpbHlDaXBoZXInXVsnYm9udXNDb2lucyddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBDbGFpbSBNb3JzZQldIDogU3VjY2Vzc2Z1bGx5IGNsYWltZWQgTW9yc2UgfCB7Ym9udXNjb2luc30gYm9udXMgY29pbnMiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFpbWVkX2NpcGhlcnMuYWRkKHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2luZm8gPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXJyb3JfaW5mby5nZXQoJ2Vycm9yX2NvZGUnKSA9PSAnREFJTFlfQ0lQSEVSX0RPVUJMRV9DTEFJTUVEJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIFN0eWxlLkJSSUdIVCArIGYiXHJbIENsYWltIE1vcnNlCV0gOiBBbHJlYWR5IGNsYWltZWQgICAgICAgICAiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBDbGFpbSBNb3JzZQldIDogRmFpbGVkIHRvIGNsYWltIE1vcnNlIHdpdGggZXJyb3I6IHtlcnJvcl9pbmZvLmdldCgnZXJyb3JfbWVzc2FnZScsICdObyBlcnJvciBtZXNzYWdlJyl9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArICJcclsgQ2xhaW0gTW9yc2UJXSA6IEZhaWxlZCB0byBwYXJzZSBKU09OIGZyb20gcmVzcG9uc2UuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIENsYWltIE1vcnNlCV0gOiBBbiBlcnJvciBvY2N1cnJlZDoge3N0cihlKX0iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBDbGFpbSBNb3JzZQldIDogTW9yc2UgaGFzIGFscmVhZHkgYmVlbiBjbGFpbWVkIHByZXZpb3VzbHkuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkJMVUUgKyBmIlxyWyBDbGFpbSBNb3JzZQldIDogLS0+IE9GRiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgUGxheSBtaW5pIEdhbWUKICAgICAgICAgICAgICAgICAgICBpZiBhdXRvX21pbmlnYW1lID09ICd5JzoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArICJcci4uLiIsIGVuZD0iIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzdGFydF9taW5pZ2FtZSh0b2tlbiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArIFN0eWxlLkJSSUdIVCArICJcclsgTWluaSBHYW1lCV0gOiBQcmVwYXJpbmcgdG8gcGxheSBNaW5pR2FtZSAgICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGRvd24obWluaWdhbWVfZGVsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2VuIG5vdCBpbiBjbGFpbWVkX21pbmlnYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArICJcclsgTWluaSBHYW1lCV0gOiBQbGF5aW5nIE1pbmlHYW1lICAgICAgICAgICAgIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjbGFpbV9NaW5pR2FtZSh0b2tlbiwgbWluaWdhbWVfZGVsYXksIGlkdXNlciwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgZiJcclsgTWluaSBHYW1lCV0gOiBTdWNjZXNzZnVsbHkgQ2xhaW1lZCBNaW5pR2FtZSAgICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYWltZWRfbWluaWdhbWUuYWRkKHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2luZm8gPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXJyb3JfaW5mby5nZXQoJ2Vycm9yX2NvZGUnKSA9PSAnREFJTFlfS0VZU19NSU5JX0dBTUVfRE9VQkxFX0NMQUlNRUQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgU3R5bGUuQlJJR0hUICsgZiJcclsgTWluaSBHYW1lCV0gOiBBbHJlYWR5IHBsYXllZCBNaW5pR2FtZSBwcmV2aW91c2x5ICAgICAgICAgICAgIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgTWluaSBHYW1lCV0gOiBGYWlsZWQgdG8gcGxheSBNaW5pR2FtZSB3aXRoIGVycm9yOiB7ZXJyb3JfaW5mby5nZXQoJ2Vycm9yX21lc3NhZ2UnLCAnTm8gZXJyb3IgbWVzc2FnZScpfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBNaW5pIEdhbWUJXSA6IEZhaWxlZCB0byBwYXJzZSBKU09OIGZyb20gcmVzcG9uc2UuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIE1pbmkgR2FtZQldIDogQW4gZXJyb3Igb2NjdXJyZWQ6IHtzdHIoZSl9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIFN0eWxlLkJSSUdIVCArIGYiXHJbIE1pbmkgR2FtZQldIDogQWxyZWFkeSBwbGF5ZWQgTWluaUdhbWUgcHJldmlvdXNseSAgICAgICAgICAgICIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgTWluaSBHYW1lCV0gOiAtLT4gT0ZGICIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgIyBkYWlseSBjb21ibwogICAgICAgICAgICAgICAgICAgIGlmIGF1dG9fY2xhaW1fY29tYm8gPT0gJ3knIGFuZCBub3QgY29tYm9fdXBncmFkZWRbaW5pdF9kYXRhX3Jhd106CiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrID0gY2xhaW1fZGFpbHlfY29tYm8odG9rZW4sIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGVjay5nZXQoJ2Vycm9yX2NvZGUnKSAhPSAnREFJTFlfQ09NQk9fRE9VQkxFX0NMQUlNRUQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VkX2NvbWJvcyA9IGNoZWNrX2NvbWJvX3B1cmNoYXNlZCh0b2tlbiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwdXJjaGFzZWRfY29tYm9zIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiXHJbIERhaWx5IENvbWJvCV0gOiBGYWlsZWQgdG8gZ2V0IGNvbWJvIHN0YXR1cywgd2lsbCB0cnkgYWdhaW4gd2l0aCB0aGUgbmV4dCBhY2NvdW50LiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjb21ibyBpbiBnZXRfY29tYm8oIml0ZW0iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29tYm8gaW4gcHVyY2hhc2VkX2NvbWJvczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIFN0eWxlLkJSSUdIVCArIGYiXHJbIERhaWx5IENvbWJvCV0gOiB7Y29tYm99IGFscmVhZHkgcHVyY2hhc2VkLiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY29tYm8gPT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIlxyWyBEYWlseSBDb21ibwldIDogQnV5IHtjb21ib30iLCBlbmQ9IiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBidXlfdXBncmFkZV9jb21ibyh0b2tlbiwgY29tYm8sIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzdWx0ID09ICdpbnN1ZmZpY2llbnRfZnVuZHMnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZCB0byBidXkge2NvbWJvfSwgbm90IGVub3VnaCBjb2lucyIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICdlcnJvcl9jb2RlJyBpbiByZXN1bHQgYW5kIHJlc3VsdFsnZXJyb3JfY29kZSddID09ICdVUEdSQURFX05PVF9BVkFJTEFCTEUnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZ3JhZGVfZGV0YWlscyA9IHJlc3VsdFsnZXJyb3JfbWVzc2FnZSddLnNwbGl0KCc6JylbLTFdLnN0cmlwKCkuc3BsaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZ3JhZGVfa2V5ID0gdXBncmFkZV9kZXRhaWxzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBncmFkZV9sZXZlbCA9IGludCh1cGdyYWRlX2RldGFpbHNbLTFdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZCB0byBidXkge2NvbWJvfSByZXF1aXJlcyB7dXBncmFkZV9rZXl9IGxldmVsIHt1cGdyYWRlX2xldmVsfSIsIGZsdXNoPVRydWUpICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IFRyeWluZyB0byBidXkge3VwZ3JhZGVfa2V5fSBsZXZlbCB7dXBncmFkZV9sZXZlbH0iLCBmbHVzaD1UcnVlKSAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjaGVja19hbmRfdXBncmFkZSh0b2tlbiwgdXBncmFkZV9rZXksIHVwZ3JhZGVfbGV2ZWwsIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvX3VwZ3JhZGVkW2luaXRfZGF0YV9yYXddID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkX2NvbWJvcyA9IHNldChnZXRfY29tYm8oIml0ZW0iKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZWRfY29tYm9zID0gc2V0KGNoZWNrX2NvbWJvX3B1cmNoYXNlZCh0b2tlbiwgcHJveHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHB1cmNoYXNlZF9jb21ib3MgPT0gcmVxdWlyZWRfY29tYm9zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgIlxyWyBEYWlseSBDb21ibwldIDogQWxsIGNvbWJvcyBoYXZlIGJlZW4gcHVyY2hhc2VkLCB0cnlpbmcgdG8gY2xhaW0gNU0gQm9udXMuICAgICAgICAgICAgICAgICAiLCBlbmQ9IiIgLGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYWltX2RhaWx5X2NvbWJvKHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNvbWJvID09ICJub25lIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgRGFpbHkgQ29tYm8JXSBDb21ibyBub3QgcmVhZHksIHdhaXRpbmcgZm9yIHNlcnZlciB1cGRhdGUuLi4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIERhaWx5IENvbWJvCV0gRmFpbGVkIHRvIGNsYWltIERhaWx5IENvbWJvLi4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcclsgRGFpbHkgQ29tYm8JXSA6IEZhaWxlZC4gQ29tYm9zIG5vdCB5ZXQgcHVyY2hhc2VkOiB7cmVxdWlyZWRfY29tYm9zIC0gcHVyY2hhc2VkX2NvbWJvc30gICAgICAgICAgICAgICAiICwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tYm9fdXBncmFkZWRbaW5pdF9kYXRhX3Jhd10gPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIGYiXHJbIERhaWx5IENvbWJvCV0gOiAtLT4gT0ZGIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAjIExpc3QgVGFza3MKICAgICAgICAgICAgICAgICAgICBpZiBhdXRvX2NoZWNrX3Rhc2tfbGlzdCA9PSAneSc6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIlxyWyBUYXNrIExpc3QJXSA6IENoZWNraW5nLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0b2tlbiBub3QgaW4gY2hlY2tfdGFza19kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfdGFza19kaWN0W3Rva2VuXSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGVja190YXNrX2RpY3RbdG9rZW5dOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBsaXN0X3Rhc2tzKHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX3Rhc2tfZGljdFt0b2tlbl0gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza3MgPSByZXNwb25zZS5qc29uKClbJ3Rhc2tzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxfY29tcGxldGVkID0gYWxsKHRhc2tbJ2lzQ29tcGxldGVkJ10gb3IgdGFza1snaWQnXSA9PSAnaW52aXRlX2ZyaWVuZHMnIGZvciB0YXNrIGluIHRhc2tzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFsbF9jb21wbGV0ZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIFN0eWxlLkJSSUdIVCArICJcclsgVGFzayBMaXN0CV0gOiBBbGwgdGFza3MgaGF2ZSBiZWVuIGNsYWltZWRcbiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRhc2sgaW4gdGFza3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGFza1snaXNDb21wbGV0ZWQnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFRhc2sgTGlzdAldIDogQ2xhaW1pbmcge3Rhc2tbJ2lkJ119Li4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY2hlY2tfdGFzayh0b2tlbiwgdGFza1snaWQnXSwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwIGFuZCByZXNwb25zZS5qc29uKClbJ3Rhc2snXVsnaXNDb21wbGV0ZWQnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFRhc2sgTGlzdAldIDogUHJldmlvdXNseSBDbGFpbWVkIHt0YXNrWydpZCddfVxuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFRhc2sgTGlzdAldIDogRmFpbGVkIHRvIENsYWltIHt0YXNrWydpZCddfVxuIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBUYXNrIExpc3QJXSA6IEZhaWxlZCB0byBnZXQgdGFzayBsaXN0IHtyZXNwb25zZS5zdGF0dXNfY29kZX1cbiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgRGFpbHkgVGFzawldIDogLS0+IE9GRiIsIGZsdXNoPVRydWUpIAogICAgICAgICAgICAgICAgICAgICMgVXBncmFkZSBFbmVyZ3kKICAgICAgICAgICAgICAgICAgICBpZiBhdXRvX3VwZ3JhZGVfZW5lcmd5ID09ICd5JzoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjaGVja19ib29zdGVyKHRva2VuLCBwcm94eSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vc3Rlcl9pbmZvID0gcmVzcG9uc2UuanNvbigpWydib29zdHNGb3JCdXknXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGJvb3N0IGluIGJvb3N0ZXJfaW5mbzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBib29zdFsnaWQnXSA9PSAnQm9vc3RNYXhUYXBzJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHZlbmVyZ2kgPSBib29zdFsnbGV2ZWwnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdnNla2FyYW5nID0gbHZlbmVyZ2ktMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbHZlbmVyZ2kgPD0gbHZfdXBncmFkZV9lbmVyZ3k6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXHJbIFVwZ3JhZGUJXSA6IFVwZ3JhZGluZyBFbmVyZ3kuLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZ3JhZGVfcmVzcG9uc2UgPSB1c2VfYm9vc3Rlcih0b2tlbiwgIkJvb3N0TWF4VGFwcyIsIHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVwZ3JhZGVfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbF9ib29zdG1heHRhcHMgPSB1cGdyYWRlX3Jlc3BvbnNlLmpzb24oKVsnY2xpY2tlclVzZXInXVsnYm9vc3RzJ11bJ0Jvb3N0TWF4VGFwcyddWydsZXZlbCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBFbmVyZ3kgU3VjY2Vzc2Z1bGx5IFVwZ3JhZGVkIHRvIExldmVsIHtsZXZlbF9ib29zdG1heHRhcHN9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArICJcclsgVXBncmFkZQldIDogRW5lcmd5IFVwZ3JhZGUgRmFpbGVkLi4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkJMVUUgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBFbmVyZ3kgbm90IHVwZ3JhZGVkLCBhbHJlYWR5IExldmVsOiB7bHZzZWthcmFuZ30iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQkxVRSArIGYiXHJbIFVwZ3JhZGUgRW5lcmd5XSA6IC0tPiBPRkYiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICMgVXBncmFkZSBNdWx0aVRhcAogICAgICAgICAgICAgICAgICAgIGlmIGF1dG9fdXBncmFkZV9tdWx0aXRhcCA9PSAneSc6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY2hlY2tfYm9vc3Rlcih0b2tlbiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJfaW5mbyA9IHJlc3BvbnNlLmpzb24oKVsnYm9vc3RzRm9yQnV5J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBib29zdCBpbiBib29zdGVyX2luZm86CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYm9vc3RbJ2lkJ10gPT0gJ0Jvb3N0RWFyblBlclRhcCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx2dGFwID0gYm9vc3RbJ2xldmVsJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHZzZWthcmFuZyA9IGx2dGFwLTEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGx2dGFwIDw9IGx2X3VwZ3JhZGVfbXVsdGl0YXA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXHJbIFVwZ3JhZGUJXSA6IFVwZ3JhZGluZyBNdWx0aVRhcC4uLi4iLCBlbmQ9IiIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBncmFkZV9yZXNwb25zZSA9IHVzZV9ib29zdGVyKHRva2VuLCAiQm9vc3RFYXJuUGVyVGFwIiwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBncmFkZV9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsX2Jvb3N0bWF4dGFwcyA9IHVwZ3JhZGVfcmVzcG9uc2UuanNvbigpWydjbGlja2VyVXNlciddWydib29zdHMnXVsnQm9vc3RFYXJuUGVyVGFwJ11bJ2xldmVsJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIFN0eWxlLkJSSUdIVCArIGYiXHJbIFVwZ3JhZGUJXSA6IE11bHRpVGFwIFN1Y2Nlc3NmdWxseSBVcGdyYWRlZCB0byBMZXZlbCB7bGV2ZWxfYm9vc3RtYXh0YXBzfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiXHJbIFVwZ3JhZGUJXSA6IE11bHRpVGFwIFVwZ3JhZGUgRmFpbGVkLi4iLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkJMVUUgKyBTdHlsZS5CUklHSFQgKyBmIlxyWyBVcGdyYWRlCV0gOiBNdWx0aVRhcCBub3QgdXBncmFkZWQsIGFscmVhZHkgTGV2ZWw6IHtsdnNla2FyYW5nfSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgVXBncmFkZSBNdWx0aVRhcF06IC0tPiBPRkYiLCBmbHVzaD1UcnVlKQoKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIHVwZ3JhZGUKICAgICAgICAgICAgICAgICAgICBpZiBhdXRvX3VwZ3JhZGVfcHBoID09ICd5JzoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXHJbIFVwZ3JhZGUJXSA6IENoZWNraW5nLi4uIiwgZW5kPSIiLCBmbHVzaD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBhdXRvX3VwZ3JhZGVfcHBoX2Vhcm4odG9rZW4sIG1heF9wcmljZSwgcHJveHkpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5CTFVFICsgZiJcclsgQXV0byBVcGdyYWRlCV0gOiAtLT4gT0ZGIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgZiJcciBGYWlsZWQgdG8gZ2V0IHVzZXIgaW5mbyB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IiwgZmx1c2g9VHJ1ZSkgCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgU3R5bGUuQlJJR0hUICsgIlxyPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IikKCiAgICAgICAgICAgIGVsaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNDAxOgogICAgICAgICAgICAgICAgZXJyb3JfZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgaWYgZXJyb3JfZGF0YS5nZXQoImVycm9yX2NvZGUiKSA9PSAiTm90Rm91bmRfU2Vzc2lvbiI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIj09PSBbIEludmFsaWQgVG9rZW4ge3Rva2VufSBdID09PSIpCiAgICAgICAgICAgICAgICAgICAgdG9rZW5fZGljdC5wb3AoaW5pdF9kYXRhX3JhdywgTm9uZSkKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IE5vbmUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiQXV0aGVudGljYXRpb24gZmFpbGVkIHdpdGggdW5rbm93biBlcnJvciIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIFN0eWxlLkJSSUdIVCArIGYiRXJyb3Igd2l0aCBzdGF0dXMgY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICB0b2tlbiA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyBmIkVycm9yIHdpdGggYWNjb3VudCB7aW5pdF9kYXRhX3Jhd30gYW5kIHByb3h5IHtwcm94eX06IHtzdHIoZSl9IiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgY29udGludWUgICMgQuG7jyBxdWEgY+G6t3AgbsOgeSB2w6AgY2h1eeG7g24gc2FuZyBj4bq3cCB0aeG6v3AgdGhlbwogICAgICAgICAgICAKICAgICAgICB0aW1lLnNsZWVwKDEpCgoKCgpkZWYgcHJpbnRfd2VsY29tZV9tZXNzYWdlKCk6CiAgICBwcmludChyIiIiCiAgX19fX18gIF8gICAgICAgICAgICAgICAgICAgICAgICBfICBfXyAgICAgCiB8ICBfXyBcfCB8ICAgICAgICAgICAgICAgICAgICAgIHwgfC8gLyAgICAgCiB8IHxfXykgfCB8X18gIF8gICBfICBfX18gICBfX18gIHwgJyAvIF9fIF8gCiB8ICBfX18vfCAnXyBcfCB8IHwgfC8gXyBcIC8gX198IHwgIDwgLyBfYCB8CiB8IHwgICAgfCB8IHwgfCB8X3wgfCAoXykgfCAoX18gIHwgLiBcIChffCB8CiB8X3wgICAgfF98IHxffFxfXyxffFxfX18vIFxfX198IHxffFxfXF9fLF98CiIiIikKICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIiBKb2luIFBLIEFpcmRyb3AgxJHhu4Mgbmjhuq1uIGPDoWMgdG9vbCBGUkVFIGhp4buHdSBjaOG7iW5oIGPhu7FjIHjhu4tuIG5ow6kgOiBodHRwczovL3QubWUvcGthaXJkcm9wOTkiICkKICAgIHByaW50KEZvcmUuUkVEICsgU3R5bGUuQlJJR0hUICsgIiBUT09MIE7DgFkgTMOAIEZSRUUsIE7hur5VIELhuqBOIFBI4bqiSSBUUuG6oiAkIMSQ4buCIEPDkyBOw5MgTMOAIELhuqBOIMSQw4MgQuG7iiBM4buqQSAhIiApCiAgICAKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkKCgoK').decode())